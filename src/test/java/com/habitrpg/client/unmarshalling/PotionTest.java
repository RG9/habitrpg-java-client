package com.habitrpg.client.unmarshalling;

import com.habitrpg.client.resource.User;
import org.codehaus.jackson.map.ObjectMapper;
import org.junit.Test;

import java.io.IOException;
import java.util.Collection;

import static org.fest.assertions.Assertions.assertThat;

public class PotionTest {

    private String response = "{\"auth\":{\"local\":{\"username\":\"habitrpgjavaclient\",\"email\":\"julien.smadja@free.fr\",\"salt\":\"6b895b7c50\",\"hashed_password\":\"2cb1ba2930e438be2d3e144f91e5a77b7229c8a1\"},\"timestamps\":{\"created\":1374007028131}},\"balance\":0,\"dailyIds\":[],\"flags\":{\"ads\":\"show\",\"customizationsNotification\":true,\"dropsEnabled\":true,\"itemsEnabled\":true,\"partyEnabled\":true},\"habitIds\":[\"7ed7eedf-e20f-4315-861b-5fa8a290577b\",\"cd633dc5-2282-4d51-89d2-787b1ea13188\"],\"history\":{\"todos\":[{\"date\":1374092461554,\"value\":-8}],\"exp\":[{\"date\":1374092461554,\"value\":-15}]},\"invitations\":{\"party\":null,\"guilds\":[]}," +
            "\"items\":{\"armor\":0,\"hatchingPotions\":[\"Base\"],\"head\":0,\"lastDrop\":{\"date\":1374255995624,\"count\":1},\"pets\":[],\"shield\":0,\"weapon\":0},\"lastCron\":1374092461554,\"preferences\":{\"gender\":\"m\",\"skin\":\"white\",\"hair\":\"blond\",\"armorSet\":\"v1\",\"dayStart\":0,\"showHelm\":true},\"rewardIds\":[],\"stats\":{\"exp\":92.5,\"gp\":74.41285578140351,\"hp\":50,\"lvl\":4,\"toNextLevel\":180,\"maxHealth\":50},\"tags\":[{\"name\":\"morning\",\"id\":\"636d779a-f417-4c56-9f88-29a22f8dcf05\"},{\"name\":\"afternoon\",\"id\":\"3f60c9d3-478b-4e28-92f0-6fe7c82e31b8\"},{\"name\":\"evening\",\"id\":\"1b68fb50-2107-454b-a681-a3a241bdb7e8\"}],\"tasks\":{\"7ed7eedf-e20f-4315-861b-5fa8a290577b\":{\"completed\":false,\"direction\":\"up\",\"down\":false,\"history\":[{\"date\":1374255800960,\"value\":1},{\"date\":1374255801885,\"value\":1.9747},{\"date\":1374255802973,\"value\":2.9253562257358428},{\"date\":1374255804548,\"value\":3.853133245658556},{\"date\":1374255805235,\"value\":4.759112700885761},{\"date\":1374255808490,\"value\":5.6443010177121415}],\"id\":\"7ed7eedf-e20f-4315-861b-5fa8a290577b\",\"notes\":\"\",\"priority\":null,\"repeat\":null,\"streak\":0,\"tags\":null,\"text\":\"my task\",\"type\":\"habit\",\"up\":false,\"value\":5.6443010177121415},\"cd633dc5-2282-4d51-89d2-787b1ea13188\":{\"completed\":false,\"direction\":\"up\",\"down\":false,\"history\":[{\"date\":1374255880465,\"value\":1},{\"date\":1374255881281,\"value\":1.9747},{\"date\":1374255882277,\"value\":2.9253562257358428},{\"date\":1374255883233,\"value\":3.853133245658556},{\"date\":1374255884216,\"value\":4.759112700885761},{\"date\":1374255886218,\"value\":5.6443010177121415},{\"date\":1374255888493,\"value\":6.5096362419810205},{\"date\":1374255889451,\"value\":7.355994112832055},{\"date\":1374255889857,\"value\":8.184193475367},{\"date\":1374255890254,\"value\":8.995001116880612},{\"date\":1374255890624,\"value\":9.789136098905757},{\"date\":1374255890980,\"value\":10.567273646958993},{\"date\":1374255891346,\"value\":11.330048651176607},{\"date\":1374255891696,\"value\":12.07805882370548},{\"date\":1374255892851,\"value\":12.811867552519566},{\"date\":1374255893495,\"value\":13.53200648607811},{\"date\":1374255894391,\"value\":14.23897787876845},{\"date\":1374255895174,\"value\":14.933256723256155},{\"date\":1374255895804,\"value\":15.615292692592663},{\"date\":1374255897148,\"value\":16.28551191211884},{\"date\":1374255899890,\"value\":16.94431857878008},{\"date\":1374255900400,\"value\":17.59209644337522},{\"date\":1374255900749,\"value\":18.229210169447946},{\"date\":1374255901096,\"value\":18.856006580954404},{\"date\":1374255901444,\"value\":19.472815809469076},{\"date\":1374255901795,\"value\":20.07995235049423},{\"date\":1374255902797,\"value\":20.677716037391143},{\"date\":1374255903149,\"value\":21.2663929405333},{\"date\":1374255903503,\"value\":21.84625619847539},{\"date\":1374255903855,\"value\":22.42606586046696},{\"date\":1374255904202,\"value\":23.005875522458528},{\"date\":1374255904561,\"value\":23.585685184450096},{\"date\":1374255906590,\"value\":24.165494846441664},{\"date\":1374255907566,\"value\":24.745304508433232},{\"date\":1374255908166,\"value\":25.3251141704248},{\"date\":1374255908913,\"value\":25.90492383241637},{\"date\":1374255911748,\"value\":26.484733494407937},{\"date\":1374255912989,\"value\":27.064543156399505},{\"date\":1374255913349,\"value\":27.644352818391074},{\"date\":1374255913695,\"value\":28.224162480382642},{\"date\":1374255914096,\"value\":28.80397214237421},{\"date\":1374255914551,\"value\":29.38378180436578},{\"date\":1374255915540,\"value\":29.963591466357347},{\"date\":1374255915904,\"value\":30.543401128348915},{\"date\":1374255916291,\"value\":31.123210790340483},{\"date\":1374255916689,\"value\":31.70302045233205},{\"date\":1374255917036,\"value\":32.28283011432362},{\"date\":1374255917392,\"value\":32.86263977631519},{\"date\":1374255917747,\"value\":33.44244943830676},{\"date\":1374255918432,\"value\":34.02225910029833},{\"date\":1374255918760,\"value\":34.602068762289896},{\"date\":1374255920111,\"value\":35.181878424281464},{\"date\":1374255930363,\"value\":35.76168808627303},{\"date\":1374255932217,\"value\":36.3414977482646},{\"date\":1374255933544,\"value\":36.92130741025617},{\"date\":1374255934531,\"value\":37.50111707224774},{\"date\":1374255935685,\"value\":38.080926734239306},{\"date\":1374255936672,\"value\":38.660736396230874},{\"date\":1374255939898,\"value\":39.24054605822244},{\"date\":1374255940493,\"value\":39.82035572021401},{\"date\":1374255940806,\"value\":40.40016538220558},{\"date\":1374255941122,\"value\":40.97997504419715},{\"date\":1374255941437,\"value\":41.559784706188715},{\"date\":1374255941745,\"value\":42.13959436818028},{\"date\":1374255942054,\"value\":42.71940403017185},{\"date\":1374255942362,\"value\":43.29921369216342},{\"date\":1374255942680,\"value\":43.87902335415499},{\"date\":1374255942987,\"value\":44.458833016146556},{\"date\":1374255943314,\"value\":45.038642678138125},{\"date\":1374255943620,\"value\":45.61845234012969},{\"date\":1374255943943,\"value\":46.19826200212126},{\"date\":1374255944253,\"value\":46.77807166411283},{\"date\":1374255944716,\"value\":47.3578813261044},{\"date\":1374255945191,\"value\":47.937690988095966},{\"date\":1374255946697,\"value\":48.517500650087534},{\"date\":1374255947456,\"value\":49.0973103120791},{\"date\":1374255948252,\"value\":49.67711997407067},{\"date\":1374255949025,\"value\":50.25692963606224},{\"date\":1374255950000,\"value\":50.83673929805381},{\"date\":1374255950464,\"value\":51.416548960045375},{\"date\":1374255953124,\"value\":51.996358622036944},{\"date\":1374255953461,\"value\":52.57616828402851},{\"date\":1374255953822,\"value\":53.15597794602008},{\"date\":1374255954175,\"value\":53.73578760801165},{\"date\":1374255954532,\"value\":54.31559727000322},{\"date\":1374255954853,\"value\":54.895406931994785},{\"date\":1374255955205,\"value\":55.47521659398635},{\"date\":1374255955622,\"value\":56.05502625597792},{\"date\":1374255955995,\"value\":56.63483591796949},{\"date\":1374255956352,\"value\":57.21464557996106},{\"date\":1374255956707,\"value\":57.794455241952626},{\"date\":1374255957066,\"value\":58.374264903944194},{\"date\":1374255957545,\"value\":58.95407456593576},{\"date\":1374255957978,\"value\":59.53388422792733},{\"date\":1374255959060,\"value\":60.1136938899189},{\"date\":1374255959855,\"value\":60.69350355191047},{\"date\":1374255960847,\"value\":61.273313213902036},{\"date\":1374255961614,\"value\":61.853122875893604},{\"date\":1374255962402,\"value\":62.43293253788517},{\"date\":1374255966020,\"value\":63.01274219987674},{\"date\":1374255966679,\"value\":63.59255186186831},{\"date\":1374255967000,\"value\":64.17236152385988},{\"date\":1374255967332,\"value\":64.75217118585145},{\"date\":1374255967652,\"value\":65.33198084784303},{\"date\":1374255967951,\"value\":65.9117905098346},{\"date\":1374255968264,\"value\":66.49160017182618},{\"date\":1374255968583,\"value\":67.07140983381775},{\"date\":1374255968898,\"value\":67.65121949580933},{\"date\":1374255969274,\"value\":68.2310291578009},{\"date\":1374255969608,\"value\":68.81083881979248},{\"date\":1374255969906,\"value\":69.39064848178405},{\"date\":1374255970257,\"value\":69.97045814377563},{\"date\":1374255976391,\"value\":70.5502678057672},{\"date\":1374255978432,\"value\":71.13007746775878},{\"date\":1374255979640,\"value\":71.70988712975036},{\"date\":1374255980785,\"value\":72.28969679174193},{\"date\":1374255981934,\"value\":72.8695064537335},{\"date\":1374255982866,\"value\":73.44931611572508},{\"date\":1374255989057,\"value\":74.02912577771666},{\"date\":1374255991092,\"value\":74.60893543970823},{\"date\":1374255992786,\"value\":75.18874510169981},{\"date\":1374255995624,\"value\":75.76855476369138}],\"id\":\"cd633dc5-2282-4d51-89d2-787b1ea13188\",\"notes\":\"\",\"priority\":null,\"repeat\":null,\"streak\":0,\"tags\":null,\"text\":\"my task\",\"type\":\"habit\",\"up\":false,\"value\":75.76855476369138}},\"todoIds\":[],\"id\":\"3de939f9-b0c0-4668-ac1c-f5a02abfe6aa\"}";

    private ObjectMapper mapper = new ObjectMapper();

    @Test
    public void should_unmarshall_potions() throws IOException {
        User user = mapper.readValue(response, User.class);

        Collection<String> hatchingPotions = user.getItems().getHatchingPotions();

        assertThat(hatchingPotions).containsOnly("Base");
    }

}
